import{_ as a,c as n,o as e,ag as i}from"./chunks/framework.7BqJGZTL.js";const d=JSON.parse('{"title":"ChromaDB 集成","description":"","frontmatter":{},"headers":[],"relativePath":"数据库设计/向量存储架构/向量数据库集成/ChromaDB 集成.md","filePath":"数据库设计/向量存储架构/向量数据库集成/ChromaDB 集成.md","lastUpdated":1764244560000}'),t={name:"数据库设计/向量存储架构/向量数据库集成/ChromaDB 集成.md"};function l(r,s,p,h,c,E){return e(),n("div",null,[...s[0]||(s[0]=[i(`<h1 id="chromadb-集成" tabindex="-1">ChromaDB 集成 <a class="header-anchor" href="#chromadb-集成" aria-label="Permalink to &quot;ChromaDB 集成&quot;">​</a></h1><cite> **本文档中引用的文件** - [chroma.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py) - [base.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/base.py) - [__init__.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/__init__.py) - [client.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/client.py) - [config.yaml](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/config.yaml) - [settings.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/settings.py) - [test_chroma.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/test/test_chroma.py) </cite><h2 id="目录" tabindex="-1">目录 <a class="header-anchor" href="#目录" aria-label="Permalink to &quot;目录&quot;">​</a></h2><ol><li><a href="#简介">简介</a></li><li><a href="#项目结构">项目结构</a></li><li><a href="#核心组件">核心组件</a></li><li><a href="#架构概览">架构概览</a></li><li><a href="#详细组件分析">详细组件分析</a></li><li><a href="#依赖关系分析">依赖关系分析</a></li><li><a href="#性能考虑">性能考虑</a></li><li><a href="#故障排除指南">故障排除指南</a></li><li><a href="#结论">结论</a></li></ol><h2 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-label="Permalink to &quot;简介&quot;">​</a></h2><p>ChromaDB 是一个开源的向量数据库，专为机器学习应用程序设计。在 AgentChat 系统中，ChromaDB 作为 VectorStoreBase 的具体实现，提供了强大的向量存储和检索功能。该集成支持本地持久化存储和远程服务器连接，具备完整的集合管理和向量操作能力。</p><h2 id="项目结构" tabindex="-1">项目结构 <a class="header-anchor" href="#项目结构" aria-label="Permalink to &quot;项目结构&quot;">​</a></h2><p>ChromaDB 集成在 AgentChat 系统中的组织结构如下：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;向量存储层&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VS[VectorStoreBase 抽象基类]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CB[ChromaDB 实现类]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VSM[VectorStoreManager 管理器]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;客户端层&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MC[AsyncMemory 客户端]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CM[ChromaClient 测试客户端]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;配置层&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CFG[config.yaml 配置文件]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SET[Settings 配置类]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VS --&gt; CB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VSM --&gt; CB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MC --&gt; VSM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CM --&gt; CB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CFG --&gt; SET</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SET --&gt; VSM</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/base.py#L4-L58" target="_blank" rel="noreferrer">base.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py#L23-L255" target="_blank" rel="noreferrer">chroma.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/__init__.py#L4-L14" target="_blank" rel="noreferrer"><strong>init</strong>.py</a></li></ul><p><strong>章节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/base.py#L1-L59" target="_blank" rel="noreferrer">base.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py#L1-L255" target="_blank" rel="noreferrer">chroma.py</a></li></ul><h2 id="核心组件" tabindex="-1">核心组件 <a class="header-anchor" href="#核心组件" aria-label="Permalink to &quot;核心组件&quot;">​</a></h2><h3 id="vectorstorebase-抽象基类" tabindex="-1">VectorStoreBase 抽象基类 <a class="header-anchor" href="#vectorstorebase-抽象基类" aria-label="Permalink to &quot;VectorStoreBase 抽象基类&quot;">​</a></h3><p>VectorStoreBase 定义了向量存储的标准接口，包含以下核心方法：</p><table tabindex="0"><thead><tr><th>方法名</th><th>描述</th><th>参数</th></tr></thead><tbody><tr><td>create_col</td><td>创建新的集合</td><td>name, vector_size, distance</td></tr><tr><td>insert</td><td>插入向量到集合</td><td>vectors, payloads=None, ids=None</td></tr><tr><td>search</td><td>搜索相似向量</td><td>query, vectors, limit=5, filters=None</td></tr><tr><td>delete</td><td>删除指定ID的向量</td><td>vector_id</td></tr><tr><td>update</td><td>更新向量及其载荷</td><td>vector_id, vector=None, payload=None</td></tr><tr><td>get</td><td>通过ID检索向量</td><td>vector_id</td></tr><tr><td>list_cols</td><td>列出所有集合</td><td>无</td></tr><tr><td>delete_col</td><td>删除集合</td><td>无</td></tr><tr><td>col_info</td><td>获取集合信息</td><td>无</td></tr><tr><td>list</td><td>列出集合中的所有向量</td><td>filters=None, limit=None</td></tr><tr><td>reset</td><td>重置索引</td><td>无</td></tr></tbody></table><h3 id="chromadb-类实现" tabindex="-1">ChromaDB 类实现 <a class="header-anchor" href="#chromadb-类实现" aria-label="Permalink to &quot;ChromaDB 类实现&quot;">​</a></h3><p>ChromaDB 是 VectorStoreBase 的具体实现，提供了完整的向量存储功能：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">classDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class VectorStoreBase {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;&lt;abstract&gt;&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+create_col(name, vector_size, distance)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+insert(vectors, payloads, ids)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+search(query, vectors, limit, filters)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+delete(vector_id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+update(vector_id, vector, payload)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+get(vector_id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+list_cols()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+delete_col()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+col_info()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+list(filters, limit)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+reset()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class ChromaDB {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-client : chromadb.Client</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-collection_name : str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-collection : chromadb.Collection</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-settings : Settings</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+__init__(collection_name, client, host, port, path)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+create_col(name, embedding_fn)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+insert(vectors, payloads, ids)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+search(query, vectors, limit, filters)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+delete(vector_id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+update(vector_id, vector, payload)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+get(vector_id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+list_cols()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+delete_col()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+col_info()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+list(filters, limit)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+reset()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-_parse_output(data)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-_generate_where_clause(where)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class OutputData {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+id : str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+score : float</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+payload : Dict</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VectorStoreBase &lt;|-- ChromaDB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ChromaDB --&gt; OutputData : creates</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/base.py#L4-L58" target="_blank" rel="noreferrer">base.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py#L23-L255" target="_blank" rel="noreferrer">chroma.py</a></li></ul><p><strong>章节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/base.py#L1-L59" target="_blank" rel="noreferrer">base.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py#L1-L255" target="_blank" rel="noreferrer">chroma.py</a></li></ul><h2 id="架构概览" tabindex="-1">架构概览 <a class="header-anchor" href="#架构概览" aria-label="Permalink to &quot;架构概览&quot;">​</a></h2><p>ChromaDB 集成采用分层架构设计，确保了良好的可扩展性和维护性：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;应用层&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">APP[应用程序]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">API[API 接口]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;业务逻辑层&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MEM[内存管理器]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CLIENT[记忆客户端]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;向量存储层&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VSTORE[向量存储管理器]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CHROMA[ChromaDB 实例]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;数据持久化层&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LOCAL[本地数据库]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">REMOTE[远程服务器]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">APP --&gt; MEM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">API --&gt; CLIENT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MEM --&gt; VSTORE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CLIENT --&gt; VSTORE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VSTORE --&gt; CHROMA</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CHROMA --&gt; LOCAL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CHROMA --&gt; REMOTE</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/client.py#L118-L130" target="_blank" rel="noreferrer">client.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/__init__.py#L4-L14" target="_blank" rel="noreferrer"><strong>init</strong>.py</a></li></ul><h2 id="详细组件分析" tabindex="-1">详细组件分析 <a class="header-anchor" href="#详细组件分析" aria-label="Permalink to &quot;详细组件分析&quot;">​</a></h2><h3 id="初始化过程" tabindex="-1">初始化过程 <a class="header-anchor" href="#初始化过程" aria-label="Permalink to &quot;初始化过程&quot;">​</a></h3><p>ChromaDB 支持两种初始化方式：</p><h4 id="_1-本地持久化初始化" tabindex="-1">1. 本地持久化初始化 <a class="header-anchor" href="#_1-本地持久化初始化" aria-label="Permalink to &quot;1. 本地持久化初始化&quot;">​</a></h4><p>当没有提供现有客户端时，系统会创建本地持久化实例：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flowchart TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">START([开始初始化]) --&gt; CHECK_CLIENT{是否提供客户端?}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CHECK_CLIENT --&gt; |是| USE_CLIENT[使用现有客户端]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CHECK_CLIENT --&gt; |否| CREATE_SETTINGS[创建配置设置]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CREATE_SETTINGS --&gt; CHECK_HOST{是否提供主机和端口?}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CHECK_HOST --&gt; |是| REMOTE_CONFIG[配置远程连接]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CHECK_HOST --&gt; |否| LOCAL_CONFIG[配置本地路径]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">REMOTE_CONFIG --&gt; SET_REMOTE[设置远程参数]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LOCAL_CONFIG --&gt; SET_LOCAL[设置本地路径]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SET_REMOTE --&gt; CREATE_CLIENT[创建 ChromaDB 客户端]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SET_LOCAL --&gt; CREATE_CLIENT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">USE_CLIENT --&gt; CREATE_COLLECTION[创建集合]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CREATE_CLIENT --&gt; CREATE_COLLECTION</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CREATE_COLLECTION --&gt; END([初始化完成])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py#L24-L61" target="_blank" rel="noreferrer">chroma.py</a></li></ul><h4 id="_2-远程服务器连接" tabindex="-1">2. 远程服务器连接 <a class="header-anchor" href="#_2-远程服务器连接" aria-label="Permalink to &quot;2. 远程服务器连接&quot;">​</a></h4><p>支持通过主机和端口连接到远程 ChromaDB 服务器：</p><table tabindex="0"><thead><tr><th>配置参数</th><th>类型</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td>host</td><td>str</td><td>服务器主机地址</td><td>None</td></tr><tr><td>port</td><td>int</td><td>服务器端口号</td><td>None</td></tr><tr><td>chroma_server_host</td><td>str</td><td>ChromaDB 服务器主机</td><td>host 值</td></tr><tr><td>chroma_server_http_port</td><td>int</td><td>ChromaDB HTTP 端口</td><td>port 值</td></tr><tr><td>chroma_api_impl</td><td>str</td><td>API 实现类型</td><td>&quot;chromadb.api.fastapi.FastAPI&quot;</td></tr></tbody></table><h3 id="集合管理" tabindex="-1">集合管理 <a class="header-anchor" href="#集合管理" aria-label="Permalink to &quot;集合管理&quot;">​</a></h3><h4 id="create-col-方法" tabindex="-1">create_col 方法 <a class="header-anchor" href="#create-col-方法" aria-label="Permalink to &quot;create_col 方法&quot;">​</a></h4><p>创建或获取集合，支持自定义嵌入函数：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Client as 客户端</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant ChromaDB as ChromaDB 实例</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant ChromaClient as ChromaDB 客户端</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Collection as 集合</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Client-&gt;&gt;ChromaDB : create_col(name, embedding_fn)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ChromaDB-&gt;&gt;ChromaClient : get_or_create_collection(name, embedding_fn)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ChromaClient-&gt;&gt;Collection : 创建或获取集合</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Collection--&gt;&gt;ChromaClient : 返回集合实例</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ChromaClient--&gt;&gt;ChromaDB : 返回集合</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ChromaDB--&gt;&gt;Client : 返回集合实例</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py#L96-L111" target="_blank" rel="noreferrer">chroma.py</a></li></ul><h4 id="集合操作方法" tabindex="-1">集合操作方法 <a class="header-anchor" href="#集合操作方法" aria-label="Permalink to &quot;集合操作方法&quot;">​</a></h4><table tabindex="0"><thead><tr><th>方法名</th><th>功能描述</th><th>返回类型</th></tr></thead><tbody><tr><td>list_cols</td><td>列出所有可用集合</td><td>List[chromadb.Collection]</td></tr><tr><td>delete_col</td><td>删除当前集合</td><td>None</td></tr><tr><td>col_info</td><td>获取集合详细信息</td><td>Dict</td></tr><tr><td>delete</td><td>删除指定ID的向量</td><td>None</td></tr></tbody></table><h3 id="向量操作" tabindex="-1">向量操作 <a class="header-anchor" href="#向量操作" aria-label="Permalink to &quot;向量操作&quot;">​</a></h3><h4 id="insert-方法" tabindex="-1">insert 方法 <a class="header-anchor" href="#insert-方法" aria-label="Permalink to &quot;insert 方法&quot;">​</a></h4><p>批量插入向量数据：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flowchart TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">INSERT_START([开始插入]) --&gt; VALIDATE_VECTORS{验证向量数据}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VALIDATE_VECTORS --&gt; |有效| LOG_INFO[记录日志]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VALIDATE_VECTORS --&gt; |无效| ERROR[抛出异常]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LOG_INFO --&gt; CALL_ADD[调用 collection.add]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CALL_ADD --&gt; SUCCESS[插入成功]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SUCCESS --&gt; END([结束])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ERROR --&gt; END</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py#L113-L128" target="_blank" rel="noreferrer">chroma.py</a></li></ul><h4 id="search-方法" tabindex="-1">search 方法 <a class="header-anchor" href="#search-方法" aria-label="Permalink to &quot;search 方法&quot;">​</a></h4><p>执行相似度搜索：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Client as 客户端</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant ChromaDB as ChromaDB 实例</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Collection as 集合</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Parser as 输出解析器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Client-&gt;&gt;ChromaDB : search(query, vectors, limit, filters)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ChromaDB-&gt;&gt;ChromaDB : _generate_where_clause(filters)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ChromaDB-&gt;&gt;Collection : query(query_embeddings, where, n_results)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Collection--&gt;&gt;ChromaDB : 原始搜索结果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ChromaDB-&gt;&gt;Parser : _parse_output(results)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Parser--&gt;&gt;ChromaDB : 解析后的 OutputData 列表</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ChromaDB--&gt;&gt;Client : 返回搜索结果</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py#L130-L148" target="_blank" rel="noreferrer">chroma.py</a></li></ul><h4 id="元数据处理" tabindex="-1">元数据处理 <a class="header-anchor" href="#元数据处理" aria-label="Permalink to &quot;元数据处理&quot;">​</a></h4><p>ChromaDB 使用 OutputData 模型封装搜索结果：</p><table tabindex="0"><thead><tr><th>字段名</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>id</td><td>str</td><td>向量唯一标识符</td></tr><tr><td>score</td><td>float</td><td>相似度分数（距离）</td></tr><tr><td>payload</td><td>Dict</td><td>元数据载荷</td></tr></tbody></table><h3 id="持久化机制" tabindex="-1">持久化机制 <a class="header-anchor" href="#持久化机制" aria-label="Permalink to &quot;持久化机制&quot;">​</a></h3><h4 id="persist-directory-设置" tabindex="-1">persist_directory 设置 <a class="header-anchor" href="#persist-directory-设置" aria-label="Permalink to &quot;persist_directory 设置&quot;">​</a></h4><p>系统支持灵活的持久化配置：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flowchart TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">INIT_PERSIST[初始化持久化] --&gt; CHECK_PATH{检查路径设置}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CHECK_PATH --&gt; |已设置| USE_PATH[使用指定路径]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CHECK_PATH --&gt; |未设置| DEFAULT_PATH[使用默认路径]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DEFAULT_PATH --&gt; MEMORY_DB[设置为 &#39;memory_db&#39;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">USE_PATH --&gt; SET_PERSIST[设置 is_persistent=True]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MEMORY_DB --&gt; SET_PERSIST</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SET_PERSIST --&gt; CONFIG_TELEMETRY[禁用遥测统计]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CONFIG_TELEMETRY --&gt; CREATE_CLIENT[创建客户端实例]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py#L45-L57" target="_blank" rel="noreferrer">chroma.py</a></li></ul><h3 id="相似度搜索实现" tabindex="-1">相似度搜索实现 <a class="header-anchor" href="#相似度搜索实现" aria-label="Permalink to &quot;相似度搜索实现&quot;">​</a></h3><h4 id="generate-where-clause-方法" tabindex="-1">_generate_where_clause 方法 <a class="header-anchor" href="#generate-where-clause-方法" aria-label="Permalink to &quot;_generate_where_clause 方法&quot;">​</a></h4><p>处理过滤条件的格式化：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flowchart TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">FILTER_INPUT[输入过滤条件] --&gt; CHECK_NULL{是否为空?}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CHECK_NULL --&gt; |是| EMPTY_FILTER[返回空字典]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CHECK_NULL --&gt; |否| CHECK_SINGLE{是否只有一个条件?}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CHECK_SINGLE --&gt; |是| RETURN_ORIGINAL[直接返回原条件]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CHECK_SINGLE --&gt; |否| PROCESS_MULTIPLE[处理多个条件]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PROCESS_MULTIPLE --&gt; GENERATE_AND[生成 $and 条件]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GENERATE_AND --&gt; RETURN_FILTER[返回组合过滤器]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EMPTY_FILTER --&gt; END([结束])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RETURN_ORIGINAL --&gt; END</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RETURN_FILTER --&gt; END</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py#L233-L255" target="_blank" rel="noreferrer">chroma.py</a></li></ul><p><strong>章节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py#L24-L255" target="_blank" rel="noreferrer">chroma.py</a></li></ul><h2 id="依赖关系分析" tabindex="-1">依赖关系分析 <a class="header-anchor" href="#依赖关系分析" aria-label="Permalink to &quot;依赖关系分析&quot;">​</a></h2><h3 id="主要依赖关系" tabindex="-1">主要依赖关系 <a class="header-anchor" href="#主要依赖关系" aria-label="Permalink to &quot;主要依赖关系&quot;">​</a></h3><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph LR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;外部依赖&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CHROMADB[chromadb 库]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PYDANTIC[pydantic]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;内部模块&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BASE[vector_stores.base]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MANAGER[vector_stores.__init__]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CLIENT[client.py]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SETTINGS[settings.py]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CHROMADB --&gt; BASE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PYDANTIC --&gt; BASE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BASE --&gt; MANAGER</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MANAGER --&gt; CLIENT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SETTINGS --&gt; MANAGER</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py#L1-L12" target="_blank" rel="noreferrer">chroma.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/base.py#L1-L3" target="_blank" rel="noreferrer">base.py</a></li></ul><h3 id="配置依赖" tabindex="-1">配置依赖 <a class="header-anchor" href="#配置依赖" aria-label="Permalink to &quot;配置依赖&quot;">​</a></h3><p>系统配置通过多层结构管理：</p><table tabindex="0"><thead><tr><th>配置层级</th><th>文件</th><th>关键配置项</th></tr></thead><tbody><tr><td>应用配置</td><td>config.yaml</td><td>memory_collection_name, vector_db.host, vector_db.port</td></tr><tr><td>设置管理</td><td>settings.py</td><td>app_settings.default_config</td></tr><tr><td>向量存储</td><td>VectorStoreManager</td><td>get_chroma_vector()</td></tr></tbody></table><p><strong>章节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/config.yaml#L112-L112" target="_blank" rel="noreferrer">config.yaml</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/settings.py#L17-L17" target="_blank" rel="noreferrer">settings.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/__init__.py#L6-L10" target="_blank" rel="noreferrer"><strong>init</strong>.py</a></li></ul><h2 id="性能考虑" tabindex="-1">性能考虑 <a class="header-anchor" href="#性能考虑" aria-label="Permalink to &quot;性能考虑&quot;">​</a></h2><h3 id="向量存储优化" tabindex="-1">向量存储优化 <a class="header-anchor" href="#向量存储优化" aria-label="Permalink to &quot;向量存储优化&quot;">​</a></h3><ol><li><strong>批量操作</strong>：支持批量插入和更新操作，减少网络往返</li><li><strong>索引策略</strong>：利用 ChromaDB 内置的向量索引机制</li><li><strong>内存管理</strong>：合理配置集合大小和过期策略</li></ol><h3 id="查询优化" tabindex="-1">查询优化 <a class="header-anchor" href="#查询优化" aria-label="Permalink to &quot;查询优化&quot;">​</a></h3><ol><li><strong>过滤器优化</strong>：使用高效的 WHERE 子句构建</li><li><strong>结果限制</strong>：通过 limit 参数控制返回结果数量</li><li><strong>缓存策略</strong>：在客户端层面实现查询结果缓存</li></ol><h3 id="持久化性能" tabindex="-1">持久化性能 <a class="header-anchor" href="#持久化性能" aria-label="Permalink to &quot;持久化性能&quot;">​</a></h3><ol><li><strong>异步操作</strong>：支持异步向量存储操作</li><li><strong>连接池</strong>：复用 ChromaDB 客户端连接</li><li><strong>压缩存储</strong>：利用 ChromaDB 的数据压缩功能</li></ol><h2 id="故障排除指南" tabindex="-1">故障排除指南 <a class="header-anchor" href="#故障排除指南" aria-label="Permalink to &quot;故障排除指南&quot;">​</a></h2><h3 id="常见问题及解决方案" tabindex="-1">常见问题及解决方案 <a class="header-anchor" href="#常见问题及解决方案" aria-label="Permalink to &quot;常见问题及解决方案&quot;">​</a></h3><h4 id="_1-导入错误" tabindex="-1">1. 导入错误 <a class="header-anchor" href="#_1-导入错误" aria-label="Permalink to &quot;1. 导入错误&quot;">​</a></h4><p><strong>问题</strong>：无法导入 chromadb 库 <strong>解决方案</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chromadb</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_2-连接失败" tabindex="-1">2. 连接失败 <a class="header-anchor" href="#_2-连接失败" aria-label="Permalink to &quot;2. 连接失败&quot;">​</a></h4><p><strong>问题</strong>：无法连接到 ChromaDB 服务器 <strong>排查步骤</strong>：</p><ul><li>检查主机和端口配置</li><li>验证网络连接</li><li>确认服务器状态</li></ul><h4 id="_3-持久化问题" tabindex="-1">3. 持久化问题 <a class="header-anchor" href="#_3-持久化问题" aria-label="Permalink to &quot;3. 持久化问题&quot;">​</a></h4><p><strong>问题</strong>：数据无法持久化 <strong>解决方案</strong>：</p><ul><li>检查 persist_directory 权限</li><li>验证磁盘空间</li><li>确认 is_persistent 设置</li></ul><h4 id="_4-内存泄漏" tabindex="-1">4. 内存泄漏 <a class="header-anchor" href="#_4-内存泄漏" aria-label="Permalink to &quot;4. 内存泄漏&quot;">​</a></h4><p><strong>问题</strong>：长时间运行后内存占用过高 <strong>解决方案</strong>：</p><ul><li>定期调用 reset() 方法</li><li>及时清理不需要的集合</li><li>监控向量存储大小</li></ul><p><strong>章节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py#L6-L10" target="_blank" rel="noreferrer">chroma.py</a></li></ul><h2 id="结论" tabindex="-1">结论 <a class="header-anchor" href="#结论" aria-label="Permalink to &quot;结论&quot;">​</a></h2><p>ChromaDB 集成为 AgentChat 系统提供了强大而灵活的向量存储解决方案。通过 VectorStoreBase 的抽象设计，系统实现了良好的可扩展性，同时保持了与不同向量数据库的兼容性。</p><h3 id="主要优势" tabindex="-1">主要优势 <a class="header-anchor" href="#主要优势" aria-label="Permalink to &quot;主要优势&quot;">​</a></h3><ol><li><strong>灵活性</strong>：支持本地和远程部署模式</li><li><strong>易用性</strong>：简洁的 API 设计和丰富的功能</li><li><strong>可靠性</strong>：完善的错误处理和数据持久化</li><li><strong>性能</strong>：高效的向量搜索和存储机制</li></ol><h3 id="最佳实践建议" tabindex="-1">最佳实践建议 <a class="header-anchor" href="#最佳实践建议" aria-label="Permalink to &quot;最佳实践建议&quot;">​</a></h3><ol><li><strong>配置管理</strong>：合理设置持久化目录和连接参数</li><li><strong>监控告警</strong>：建立向量存储状态监控机制</li><li><strong>定期维护</strong>：执行定期的数据清理和索引重建</li><li><strong>安全考虑</strong>：确保网络通信的安全性</li></ol><p>通过遵循本文档的指导原则和最佳实践，开发者可以充分利用 ChromaDB 的强大功能，构建高性能的记忆管理系统。</p>`,116)])])}const b=a(t,[["render",l]]);export{d as __pageData,b as default};
