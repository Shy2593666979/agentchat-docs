import{_ as a,c as n,o as i,ag as e}from"./chunks/framework.D0TaUBpX.js";const o=JSON.parse('{"title":"服务管理","description":"","frontmatter":{},"headers":[],"relativePath":"部署指南/运维管理/服务管理.md","filePath":"部署指南/运维管理/服务管理.md","lastUpdated":1764244560000}'),l={name:"部署指南/运维管理/服务管理.md"};function t(p,s,r,h,d,k){return i(),n("div",null,[...s[0]||(s[0]=[e(`<h1 id="服务管理" tabindex="-1">服务管理 <a class="header-anchor" href="#服务管理" aria-label="Permalink to &quot;服务管理&quot;">​</a></h1><cite> **本文档引用的文件** - [start.sh](https://github.com/Shy2593666979/AgentChat/docker/start.sh) - [stop.sh](https://github.com/Shy2593666979/AgentChat/docker/stop.sh) - [docker-compose.yml](https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml) - [docker-compose.prod.yml](https://github.com/Shy2593666979/AgentChat/docker/docker-compose.prod.yml) - [Dockerfile](https://github.com/Shy2593666979/AgentChat/docker/Dockerfile) - [docker.env.example](https://github.com/Shy2593666979/AgentChat/docker/docker.env.example) - [nginx.conf](https://github.com/Shy2593666979/AgentChat/docker/nginx.conf) - [README.md](https://github.com/Shy2593666979/AgentChat/docker/README.md) </cite><h2 id="目录" tabindex="-1">目录 <a class="header-anchor" href="#目录" aria-label="Permalink to &quot;目录&quot;">​</a></h2><ol><li><a href="#简介">简介</a></li><li><a href="#项目结构概览">项目结构概览</a></li><li><a href="#核心服务组件">核心服务组件</a></li><li><a href="#架构概览">架构概览</a></li><li><a href="#详细组件分析">详细组件分析</a></li><li><a href="#服务启动管理">服务启动管理</a></li><li><a href="#服务停止管理">服务停止管理</a></li><li><a href="#配置文件管理">配置文件管理</a></li><li><a href="#健康检查机制">健康检查机制</a></li><li><a href="#日志监控与诊断">日志监控与诊断</a></li><li><a href="#常见问题排查">常见问题排查</a></li><li><a href="#性能监控与优化">性能监控与优化</a></li><li><a href="#总结">总结</a></li></ol><h2 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-label="Permalink to &quot;简介&quot;">​</a></h2><p>AgentChat 是一个基于 Docker 容器化的智能对话平台，采用微服务架构设计。本指南详细介绍了服务的启动、停止、重启和状态监控操作，以及相关的配置管理和故障排除方法。</p><h2 id="项目结构概览" tabindex="-1">项目结构概览 <a class="header-anchor" href="#项目结构概览" aria-label="Permalink to &quot;项目结构概览&quot;">​</a></h2><p>AgentChat 的服务管理主要集中在 <code>docker/</code> 目录下，包含以下核心文件：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;Docker 服务管理&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A[start.sh] --&gt; B[服务启动脚本]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">C[stop.sh] --&gt; D[服务停止脚本]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">E[docker-compose.yml] --&gt; F[开发环境配置]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">G[docker-compose.prod.yml] --&gt; H[生产环境配置]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">I[Dockerfile] --&gt; J[后端镜像构建]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">K[network.conf] --&gt; L[Nginx 反向代理]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;配置文件&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">M[docker.env.example] --&gt; N[环境变量模板]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A --&gt; E</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">C --&gt; E</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">E --&gt; G</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/start.sh#L1-L52" target="_blank" rel="noreferrer">start.sh</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/docker/stop.sh#L1-L35" target="_blank" rel="noreferrer">stop.sh</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml#L1-L126" target="_blank" rel="noreferrer">docker-compose.yml</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.prod.yml#L1-L52" target="_blank" rel="noreferrer">docker-compose.prod.yml</a></li></ul><h2 id="核心服务组件" tabindex="-1">核心服务组件 <a class="header-anchor" href="#核心服务组件" aria-label="Permalink to &quot;核心服务组件&quot;">​</a></h2><p>AgentChat 包含以下核心服务组件：</p><table tabindex="0"><thead><tr><th>服务名称</th><th>容器名称</th><th>端口</th><th>功能描述</th><th>健康检查</th></tr></thead><tbody><tr><td>MySQL数据库</td><td>agentchat-mysql</td><td>3306</td><td>主数据库存储</td><td>mysqladmin ping</td></tr><tr><td>Redis缓存</td><td>agentchat-redis</td><td>6379</td><td>缓存和会话存储</td><td>redis-cli ping</td></tr><tr><td>后端API</td><td>agentchat-backend</td><td>7860</td><td>FastAPI应用服务</td><td>curl health check</td></tr><tr><td>前端开发</td><td>agentchat-frontend</td><td>8090</td><td>Vue3开发服务器</td><td>curl health check</td></tr></tbody></table><p><strong>章节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml#L8-L126" target="_blank" rel="noreferrer">docker-compose.yml</a></li></ul><h2 id="架构概览" tabindex="-1">架构概览 <a class="header-anchor" href="#架构概览" aria-label="Permalink to &quot;架构概览&quot;">​</a></h2><p>AgentChat 采用多层架构设计，支持开发和生产两种环境：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;客户端层&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A[Web浏览器] --&gt; B[Nginx反向代理]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;负载均衡层&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">B --&gt; C[前端服务:8090]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">B --&gt; D[后端服务:7860]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;应用服务层&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">C --&gt; E[Vue3前端应用]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">D --&gt; F[FastAPI后端服务]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;数据存储层&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">F --&gt; G[MySQL数据库:3306]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">F --&gt; H[Redis缓存:6379]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;网络层&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">I[agentchat-network] --&gt; C</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">I --&gt; D</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">I --&gt; E</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">I --&gt; F</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">I --&gt; G</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">I --&gt; H</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml#L3-L6" target="_blank" rel="noreferrer">docker-compose.yml</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/docker/nginx.conf#L67-L101" target="_blank" rel="noreferrer">nginx.conf</a></li></ul><h2 id="详细组件分析" tabindex="-1">详细组件分析 <a class="header-anchor" href="#详细组件分析" aria-label="Permalink to &quot;详细组件分析&quot;">​</a></h2><h3 id="后端服务组件" tabindex="-1">后端服务组件 <a class="header-anchor" href="#后端服务组件" aria-label="Permalink to &quot;后端服务组件&quot;">​</a></h3><p>后端服务基于 FastAPI 框架构建，采用 Uvicorn 作为 ASGI 服务器：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">classDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class BackendService {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+string container_name : agentchat-backend</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+string image : python : 3.12-slim</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+string[] depends_on : mysql, redis</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+HealthCheck healthcheck</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+EnvironmentVariables environment</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+start() void</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+restart() void</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+stop() void</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+getStatus() ServiceStatus</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class HealthCheck {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+string[] test : curl health endpoint</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+Duration interval : 30s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+Duration timeout : 10s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+int retries : 3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class EnvironmentVariables {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+string DATABASE_URL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+string REDIS_URL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+string APP_ENV</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+string JWT_SECRET_KEY</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+string[] AI_API_KEYS</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BackendService --&gt; HealthCheck</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BackendService --&gt; EnvironmentVariables</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml#L51-L93" target="_blank" rel="noreferrer">docker-compose.yml</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/docker/Dockerfile#L1-L39" target="_blank" rel="noreferrer">Dockerfile</a></li></ul><h3 id="数据库服务组件" tabindex="-1">数据库服务组件 <a class="header-anchor" href="#数据库服务组件" aria-label="Permalink to &quot;数据库服务组件&quot;">​</a></h3><p>MySQL 和 Redis 服务提供数据持久化和缓存功能：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant BC as Backend Container</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant MC as MySQL Container</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant RC as Redis Container</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BC-&gt;&gt;MC : 连接数据库 (3306)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MC--&gt;&gt;BC : 数据库就绪</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BC-&gt;&gt;RC : 连接缓存 (6379)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RC--&gt;&gt;BC : 缓存就绪</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BC-&gt;&gt;MC : 执行健康检查</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MC--&gt;&gt;BC : PING响应</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BC-&gt;&gt;RC : 执行健康检查</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RC--&gt;&gt;BC : PING响应</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml#L8-L49" target="_blank" rel="noreferrer">docker-compose.yml</a></li></ul><p><strong>章节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml#L8-L93" target="_blank" rel="noreferrer">docker-compose.yml</a></li></ul><h2 id="服务启动管理" tabindex="-1">服务启动管理 <a class="header-anchor" href="#服务启动管理" aria-label="Permalink to &quot;服务启动管理&quot;">​</a></h2><h3 id="启动脚本分析" tabindex="-1">启动脚本分析 <a class="header-anchor" href="#启动脚本分析" aria-label="Permalink to &quot;启动脚本分析&quot;">​</a></h3><p>启动脚本 <code>start.sh</code> 提供了完整的服务启动流程：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flowchart TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A[开始启动] --&gt; B{检查docker.env文件}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">B --&gt; |不存在| C[复制配置模板]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">B --&gt; |存在| D[创建必要目录]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">C --&gt; D</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">D --&gt; E[构建并启动服务]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">E --&gt; F[等待10秒]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">F --&gt; G[检查服务状态]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">G --&gt; H[显示访问信息]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">H --&gt; I[结束]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">style A fill:#e1f5fe</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">style I fill:#c8e6c9</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/start.sh#L1-L52" target="_blank" rel="noreferrer">start.sh</a></li></ul><h3 id="启动流程详解" tabindex="-1">启动流程详解 <a class="header-anchor" href="#启动流程详解" aria-label="Permalink to &quot;启动流程详解&quot;">​</a></h3><ol><li><strong>环境变量检查</strong>：自动检测并创建环境变量配置文件</li><li><strong>目录创建</strong>：初始化数据和日志目录</li><li><strong>服务构建</strong>：使用 Docker Compose 构建并启动所有服务</li><li><strong>健康检查</strong>：等待服务启动并验证状态</li></ol><h3 id="启动命令使用" tabindex="-1">启动命令使用 <a class="header-anchor" href="#启动命令使用" aria-label="Permalink to &quot;启动命令使用&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 进入docker目录</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置执行权限</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动所有服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./start.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>章节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/start.sh#L1-L52" target="_blank" rel="noreferrer">start.sh</a></li></ul><h2 id="服务停止管理" tabindex="-1">服务停止管理 <a class="header-anchor" href="#服务停止管理" aria-label="Permalink to &quot;服务停止管理&quot;">​</a></h2><h3 id="停止脚本分析" tabindex="-1">停止脚本分析 <a class="header-anchor" href="#停止脚本分析" aria-label="Permalink to &quot;停止脚本分析&quot;">​</a></h3><p>停止脚本提供了安全的服务终止机制：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flowchart TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A[开始停止] --&gt; B[停止所有容器]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">B --&gt; C[询问是否删除数据]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">C --&gt; |是| D[清理数据卷]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">C --&gt; |否| E[保留数据]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">D --&gt; F[清理构建缓存]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">E --&gt; G[显示重新启动提示]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">F --&gt; G</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">G --&gt; H[结束]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">style A fill:#ffebee</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">style H fill:#c8e6c9</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/stop.sh#L1-L35" target="_blank" rel="noreferrer">stop.sh</a></li></ul><h3 id="停止选项说明" tabindex="-1">停止选项说明 <a class="header-anchor" href="#停止选项说明" aria-label="Permalink to &quot;停止选项说明&quot;">​</a></h3><table tabindex="0"><thead><tr><th>选项</th><th>功能描述</th><th>数据处理</th></tr></thead><tbody><tr><td>停止容器</td><td>正常关闭所有服务</td><td>保留</td></tr><tr><td>删除数据</td><td>清理所有数据卷</td><td>删除</td></tr><tr><td>清理缓存</td><td>移除构建缓存</td><td>删除</td></tr></tbody></table><p><strong>章节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/stop.sh#L1-L35" target="_blank" rel="noreferrer">stop.sh</a></li></ul><h2 id="配置文件管理" tabindex="-1">配置文件管理 <a class="header-anchor" href="#配置文件管理" aria-label="Permalink to &quot;配置文件管理&quot;">​</a></h2><h3 id="环境变量配置" tabindex="-1">环境变量配置 <a class="header-anchor" href="#环境变量配置" aria-label="Permalink to &quot;环境变量配置&quot;">​</a></h3><p>AgentChat 使用 <code>.env</code> 文件管理环境变量：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph LR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;配置分类&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A[AI模型配置] --&gt; B[OpenAI API Key]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A --&gt; C[Anthropic API Key]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A --&gt; D[通义千问 API Key]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">E[数据库配置] --&gt; F[MySQL 密码]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">E --&gt; G[Redis 密码]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">H[安全配置] --&gt; I[JWT Secret Key]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">J[应用配置] --&gt; K[应用环境]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">J --&gt; L[日志级别]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker.env.example#L1-L73" target="_blank" rel="noreferrer">docker.env.example</a></li></ul><h3 id="配置文件结构" tabindex="-1">配置文件结构 <a class="header-anchor" href="#配置文件结构" aria-label="Permalink to &quot;配置文件结构&quot;">​</a></h3><table tabindex="0"><thead><tr><th>配置类别</th><th>关键字</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>AI模型</td><td>OPENAI_API_KEY</td><td>-</td><td>OpenAI API 密钥</td></tr><tr><td>数据库</td><td>MYSQL_ROOT_PASSWORD</td><td>123456</td><td>MySQL root 密码</td></tr><tr><td>安全</td><td>JWT_SECRET_KEY</td><td>-</td><td>JWT 加密密钥</td></tr><tr><td>应用</td><td>APP_ENV</td><td>development</td><td>应用环境类型</td></tr></tbody></table><p><strong>章节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker.env.example#L1-L73" target="_blank" rel="noreferrer">docker.env.example</a></li></ul><h2 id="健康检查机制" tabindex="-1">健康检查机制 <a class="header-anchor" href="#健康检查机制" aria-label="Permalink to &quot;健康检查机制&quot;">​</a></h2><h3 id="服务健康检查配置" tabindex="-1">服务健康检查配置 <a class="header-anchor" href="#服务健康检查配置" aria-label="Permalink to &quot;服务健康检查配置&quot;">​</a></h3><p>每个服务都配置了相应的健康检查机制：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;健康检查类型&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A[MySQL健康检查] --&gt; B[mysqladmin ping]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">C[Redis健康检查] --&gt; D[redis-cli ping]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">E[后端健康检查] --&gt; F[curl /health]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">G[前端健康检查] --&gt; H[curl /]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;检查参数&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">I[间隔时间: 30s/60s]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">J[超时时间: 10s/30s]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">K[重试次数: 3次]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">L[启动期: 40s/30s]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml#L26-L118" target="_blank" rel="noreferrer">docker-compose.yml</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.prod.yml#L14-L34" target="_blank" rel="noreferrer">docker-compose.prod.yml</a></li></ul><h3 id="健康检查策略" tabindex="-1">健康检查策略 <a class="header-anchor" href="#健康检查策略" aria-label="Permalink to &quot;健康检查策略&quot;">​</a></h3><table tabindex="0"><thead><tr><th>服务类型</th><th>检查方式</th><th>检查频率</th><th>超时时间</th><th>重试次数</th></tr></thead><tbody><tr><td>数据库服务</td><td>命令行工具</td><td>30秒</td><td>20秒</td><td>10次</td></tr><tr><td>缓存服务</td><td>CLI工具</td><td>30秒</td><td>10秒</td><td>3次</td></tr><tr><td>Web服务</td><td>HTTP请求</td><td>30/60秒</td><td>10/30秒</td><td>3次</td></tr></tbody></table><p><strong>章节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml#L26-L118" target="_blank" rel="noreferrer">docker-compose.yml</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.prod.yml#L14-L52" target="_blank" rel="noreferrer">docker-compose.prod.yml</a></li></ul><h2 id="日志监控与诊断" tabindex="-1">日志监控与诊断 <a class="header-anchor" href="#日志监控与诊断" aria-label="Permalink to &quot;日志监控与诊断&quot;">​</a></h2><h3 id="日志查看命令" tabindex="-1">日志查看命令 <a class="header-anchor" href="#日志查看命令" aria-label="Permalink to &quot;日志查看命令&quot;">​</a></h3><p>AgentChat 提供了多种日志查看方式：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flowchart LR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A[docker-compose logs] --&gt; B[查看所有服务日志]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A --&gt; C[查看特定服务日志]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A --&gt; D[实时跟踪日志]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">B --&gt; E[docker-compose logs -f]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">C --&gt; F[docker-compose logs -f backend]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">D --&gt; G[--tail=100 参数]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">style A fill:#e3f2fd</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">style B fill:#f3e5f5</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="日志管理命令" tabindex="-1">日志管理命令 <a class="header-anchor" href="#日志管理命令" aria-label="Permalink to &quot;日志管理命令&quot;">​</a></h3><table tabindex="0"><thead><tr><th>命令</th><th>功能</th><th>使用场景</th></tr></thead><tbody><tr><td><code>docker-compose logs -f</code></td><td>实时跟踪所有日志</td><td>服务监控</td></tr><tr><td><code>docker-compose logs -f backend</code></td><td>查看后端服务日志</td><td>后端问题排查</td></tr><tr><td><code>docker-compose logs -f frontend</code></td><td>查看前端服务日志</td><td>前端问题排查</td></tr><tr><td><code>docker-compose logs --tail=100 backend</code></td><td>查看最近100行日志</td><td>快速定位问题</td></tr></tbody></table><h3 id="容器状态监控" tabindex="-1">容器状态监控 <a class="header-anchor" href="#容器状态监控" aria-label="Permalink to &quot;容器状态监控&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看服务状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看容器资源使用情况</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stats</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看特定容器统计信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stats</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> agentchat-backend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> agentchat-frontend</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>章节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/start.sh#L45-L48" target="_blank" rel="noreferrer">start.sh</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/docker/README.md#L115-L167" target="_blank" rel="noreferrer">README.md</a></li></ul><h2 id="常见问题排查" tabindex="-1">常见问题排查 <a class="header-anchor" href="#常见问题排查" aria-label="Permalink to &quot;常见问题排查&quot;">​</a></h2><h3 id="服务启动失败" tabindex="-1">服务启动失败 <a class="header-anchor" href="#服务启动失败" aria-label="Permalink to &quot;服务启动失败&quot;">​</a></h3><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flowchart TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A[服务启动失败] --&gt; B{检查日志}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">B --&gt; C[配置文件错误]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">B --&gt; D[端口冲突]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">B --&gt; E[依赖服务未就绪]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">C --&gt; F[检查docker.env配置]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">D --&gt; G[修改端口映射]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">E --&gt; H[等待健康检查]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">F --&gt; I[重新启动服务]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">G --&gt; I</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">H --&gt; I</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="端口冲突解决" tabindex="-1">端口冲突解决 <a class="header-anchor" href="#端口冲突解决" aria-label="Permalink to &quot;端口冲突解决&quot;">​</a></h3><p>当遇到端口占用问题时：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查端口占用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lsof</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :7860</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lsof</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :8090</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改docker-compose.yml中的端口映射</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ports:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;17860:7860&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 改为其他端口</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="数据库连接问题" tabindex="-1">数据库连接问题 <a class="header-anchor" href="#数据库连接问题" aria-label="Permalink to &quot;数据库连接问题&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查MySQL容器状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 进入MySQL容器进行诊断</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重置数据库服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> down</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> volume</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker_mysql_data</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="api密钥配置问题" tabindex="-1">API密钥配置问题 <a class="header-anchor" href="#api密钥配置问题" aria-label="Permalink to &quot;API密钥配置问题&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查环境变量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> printenv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> API_KEY</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重新设置环境变量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker.env</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backend</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>章节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/README.md#L170-L250" target="_blank" rel="noreferrer">README.md</a></li></ul><h2 id="性能监控与优化" tabindex="-1">性能监控与优化 <a class="header-anchor" href="#性能监控与优化" aria-label="Permalink to &quot;性能监控与优化&quot;">​</a></h2><h3 id="资源监控" tabindex="-1">资源监控 <a class="header-anchor" href="#资源监控" aria-label="Permalink to &quot;资源监控&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 实时监控容器资源使用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stats</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 监控特定服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stats</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> agentchat-backend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> agentchat-frontend</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看容器网络状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> network</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> network</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inspect</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> agentchat-network</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="性能优化建议" tabindex="-1">性能优化建议 <a class="header-anchor" href="#性能优化建议" aria-label="Permalink to &quot;性能优化建议&quot;">​</a></h3><table tabindex="0"><thead><tr><th>优化方面</th><th>建议配置</th><th>说明</th></tr></thead><tbody><tr><td>内存限制</td><td>Redis: 512MB, MySQL: 1GB</td><td>防止内存溢出</td></tr><tr><td>CPU核心数</td><td>后端: 4核</td><td>提高并发处理能力</td></tr><tr><td>网络带宽</td><td>根据需求调整</td><td>优化网络传输效率</td></tr><tr><td>存储I/O</td><td>SSD存储</td><td>提高数据读写速度</td></tr></tbody></table><h3 id="生产环境配置" tabindex="-1">生产环境配置 <a class="header-anchor" href="#生产环境配置" aria-label="Permalink to &quot;生产环境配置&quot;">​</a></h3><p>生产环境使用专门的配置文件：</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;开发环境&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A[docker-compose.yml] --&gt; B[开发服务配置]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">C[热重载] --&gt; D[快速开发]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;生产环境&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">E[docker-compose.prod.yml] --&gt; F[生产服务配置]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">G[Gunicorn + Uvicorn] --&gt; H[高性能部署]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">style E fill:#e8f5e8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">style G fill:#fff3e0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>图表来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml#L1-L126" target="_blank" rel="noreferrer">docker-compose.yml</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.prod.yml#L1-L52" target="_blank" rel="noreferrer">docker-compose.prod.yml</a></li></ul><p><strong>章节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.prod.yml#L1-L52" target="_blank" rel="noreferrer">docker-compose.prod.yml</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/docker/README.md#L250-L272" target="_blank" rel="noreferrer">README.md</a></li></ul><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p>AgentChat 的服务管理系统提供了完整的一站式解决方案，包括：</p><ol><li><strong>自动化启动管理</strong>：通过 <code>start.sh</code> 脚本实现一键启动</li><li><strong>灵活的配置管理</strong>：支持开发和生产环境的不同配置</li><li><strong>完善的健康检查</strong>：确保服务稳定运行</li><li><strong>全面的日志监控</strong>：便于问题诊断和性能优化</li><li><strong>详细的故障排除</strong>：提供常见问题的解决方案</li></ol><p>通过遵循本指南中的最佳实践，可以确保 AgentChat 服务的稳定运行和高效管理。定期监控服务状态、及时处理异常情况，以及根据实际需求调整配置参数，都是维护系统稳定性的关键措施。</p>`,114)])])}const b=a(l,[["render",t]]);export{o as __pageData,b as default};
