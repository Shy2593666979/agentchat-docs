import{_ as a,c as n,o as e,ag as i}from"./chunks/framework.D0TaUBpX.js";const d=JSON.parse('{"title":"知识库系统","description":"","frontmatter":{},"headers":[],"relativePath":"核心功能模块/知识库系统.md","filePath":"核心功能模块/知识库系统.md","lastUpdated":1764244560000}'),l={name:"核心功能模块/知识库系统.md"};function r(p,s,t,h,c,k){return e(),n("div",null,[...s[0]||(s[0]=[i(`<h1 id="知识库系统" tabindex="-1">知识库系统 <a class="header-anchor" href="#知识库系统" aria-label="Permalink to &quot;知识库系统&quot;">​</a></h1><cite> **本文档引用的文件** - [rag_handler.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag_handler.py) - [retrieval.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/retrieval.py) - [parser.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/parser.py) - [embedding.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/embedding.py) - [rerank.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/rerank.py) - [es_client.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/es_client.py) - [milvus.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/milvus.py) - [chroma.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py) - [query_write.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rewrite/query_write.py) - [pdf.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/doc_parser/pdf.py) - [docx.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/doc_parser/docx.py) - [text.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/doc_parser/text.py) - [markdown.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/doc_parser/markdown.py) - [chunk.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/schema/chunk.py) - [knowledge.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/api/v1/knowledge.py) - [knowledge-file.ts](https://github.com/Shy2593666979/AgentChat/src/frontend/src/apis/knowledge-file.ts) </cite><h2 id="目录" tabindex="-1">目录 <a class="header-anchor" href="#目录" aria-label="Permalink to &quot;目录&quot;">​</a></h2><ol><li><a href="#系统架构概述">系统架构概述</a></li><li><a href="#文档上传与解析流程">文档上传与解析流程</a></li><li><a href="#文本分块与向量化">文本分块与向量化</a></li><li><a href="#向量存储与检索">向量存储与检索</a></li><li><a href="#全文检索与重排序">全文检索与重排序</a></li><li><a href="#rag问答集成">RAG问答集成</a></li><li><a href="#api接口与前端交互">API接口与前端交互</a></li><li><a href="#常见问题与优化策略">常见问题与优化策略</a></li></ol><h2 id="系统架构概述" tabindex="-1">系统架构概述 <a class="header-anchor" href="#系统架构概述" aria-label="Permalink to &quot;系统架构概述&quot;">​</a></h2><p>知识库系统采用RAG（检索增强生成）架构，实现了从文档上传、解析、向量化到语义搜索的完整流程。系统通过多模态文档解析器支持多种文件格式，利用向量数据库和Elasticsearch实现混合检索，并通过重排序模块提升检索精度。</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;前端&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">UI[用户界面]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">API[API调用]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subgraph &quot;后端&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Upload[文档上传]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Parser[文档解析器]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Chunking[文本分块]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Embedding[向量化]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VectorDB[向量数据库]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ES[Elasticsearch]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Rerank[重排序]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RAG[RAG问答]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">UI --&gt; API</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">API --&gt; Upload</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Upload --&gt; Parser</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Parser --&gt; Chunking</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Chunking --&gt; Embedding</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Embedding --&gt; VectorDB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Embedding --&gt; ES</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VectorDB --&gt; Rerank</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ES --&gt; Rerank</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Rerank --&gt; RAG</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>图示来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag_handler.py" target="_blank" rel="noreferrer">rag_handler.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/parser.py" target="_blank" rel="noreferrer">parser.py</a></li></ul><h2 id="文档上传与解析流程" tabindex="-1">文档上传与解析流程 <a class="header-anchor" href="#文档上传与解析流程" aria-label="Permalink to &quot;文档上传与解析流程&quot;">​</a></h2><p>系统支持PDF、DOCX、PPTX、Markdown和纯文本等多种文件格式的上传与解析。文档解析流程采用统一的处理架构，不同格式的文档通过相应的解析器转换为统一的文本格式。</p><h3 id="支持的文件格式" tabindex="-1">支持的文件格式 <a class="header-anchor" href="#支持的文件格式" aria-label="Permalink to &quot;支持的文件格式&quot;">​</a></h3><p>系统支持以下文件格式的解析：</p><ul><li><strong>PDF</strong>: 通过pymupdf4llm库解析，保留文本和图像信息</li><li><strong>DOCX</strong>: 转换为PDF后使用PDF解析器处理</li><li><strong>PPTX</strong>: 通过python-pptx库解析幻灯片内容</li><li><strong>Markdown</strong>: 直接解析，保留标题结构和链接</li><li><strong>纯文本</strong>: 按行分割处理</li></ul><h3 id="文档解析逻辑" tabindex="-1">文档解析逻辑 <a class="header-anchor" href="#文档解析逻辑" aria-label="Permalink to &quot;文档解析逻辑&quot;">​</a></h3><p>文档解析器采用模块化设计，每个文件格式都有对应的解析器类。系统通过文件后缀名选择相应的解析器进行处理。</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">classDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class DocParser {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+parse_doc_into_chunks(file_id, file_path, knowledge_id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+generate_summary(chunk, semaphore)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class PDFParser {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+convert_markdown(file_path)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+parse_into_chunks(file_id, file_path, knowledge_id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+upload_file_to_oss(file_path)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+upload_folder_to_oss(file_dir)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class DocxParser {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+convert_pdf(file_path)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+parse_into_chunks(file_id, file_path, knowledge_id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class MarkdownParser {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+parse_markdown_headers(text)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+split_text_with_headers(text, header_path)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+find_link_boundaries(text)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+is_safe_cut_position(text, position, boundaries)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+find_best_cut_position(text, target_position, boundaries)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class TextParser {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+split_text_into_chunks_by_lines(text)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+parse_file(file_path)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+parse_into_chunks(file_id, file_path, knowledge_id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DocParser &lt;|-- PDFParser</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DocParser &lt;|-- DocxParser</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DocParser &lt;|-- MarkdownParser</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DocParser &lt;|-- TextParser</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong>图示来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/parser.py" target="_blank" rel="noreferrer">parser.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/doc_parser/pdf.py" target="_blank" rel="noreferrer">pdf.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/doc_parser/docx.py" target="_blank" rel="noreferrer">docx.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/doc_parser/markdown.py" target="_blank" rel="noreferrer">markdown.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/doc_parser/text.py" target="_blank" rel="noreferrer">text.py</a></li></ul><p><strong>本节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/parser.py#L1-L58" target="_blank" rel="noreferrer">parser.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/doc_parser/pdf.py#L1-L80" target="_blank" rel="noreferrer">pdf.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/doc_parser/docx.py#L1-L66" target="_blank" rel="noreferrer">docx.py</a></li></ul><h2 id="文本分块与向量化" tabindex="-1">文本分块与向量化 <a class="header-anchor" href="#文本分块与向量化" aria-label="Permalink to &quot;文本分块与向量化&quot;">​</a></h2><p>文档解析后，系统将文本内容进行分块处理，并生成对应的向量表示，为后续的语义搜索做准备。</p><h3 id="文本分块策略" tabindex="-1">文本分块策略 <a class="header-anchor" href="#文本分块策略" aria-label="Permalink to &quot;文本分块策略&quot;">​</a></h3><p>系统采用智能分块策略，根据不同文档类型采用不同的分块方法：</p><ul><li><strong>Markdown文档</strong>: 按标题结构分块，保留完整的标题路径</li><li><strong>纯文本</strong>: 按换行符切割，确保每个块的大小在指定范围内</li><li><strong>长段落</strong>: 当段落过长时，按句子边界进行切割，避免切断链接或图片引用</li></ul><p>分块参数可通过配置文件调整：</p><ul><li><code>chunk_size</code>: 块的最大字符数</li><li><code>overlap_size</code>: 块之间的重叠字符数</li><li><code>min_chunk_size</code>: 块的最小字符数</li></ul><h3 id="向量化过程" tabindex="-1">向量化过程 <a class="header-anchor" href="#向量化过程" aria-label="Permalink to &quot;向量化过程&quot;">​</a></h3><p>文本向量化是将文本转换为数值向量的过程，系统使用预训练的语言模型生成文本的向量表示。</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Client as &quot;客户端&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Parser as &quot;文档解析器&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Chunking as &quot;文本分块&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Embedding as &quot;向量化&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant VectorDB as &quot;向量数据库&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Client-&gt;&gt;Parser : 上传文档</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Parser-&gt;&gt;Chunking : 解析为文本</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Chunking-&gt;&gt;Chunking : 按规则分块</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Chunking-&gt;&gt;Embedding : 发送文本块</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Embedding-&gt;&gt;Embedding : 调用嵌入模型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Embedding-&gt;&gt;VectorDB : 存储向量数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VectorDB--&gt;&gt;Embedding : 确认存储</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Embedding--&gt;&gt;Chunking : 确认向量化</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Chunking--&gt;&gt;Parser : 确认分块完成</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Parser--&gt;&gt;Client : 处理完成</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>图示来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/parser.py" target="_blank" rel="noreferrer">parser.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/embedding.py" target="_blank" rel="noreferrer">embedding.py</a></li></ul><p><strong>本节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/parser.py#L1-L58" target="_blank" rel="noreferrer">parser.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/embedding.py#L1-L50" target="_blank" rel="noreferrer">embedding.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/doc_parser/text.py#L1-L86" target="_blank" rel="noreferrer">text.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/doc_parser/markdown.py#L1-L405" target="_blank" rel="noreferrer">markdown.py</a></li></ul><h2 id="向量存储与检索" tabindex="-1">向量存储与检索 <a class="header-anchor" href="#向量存储与检索" aria-label="Permalink to &quot;向量存储与检索&quot;">​</a></h2><p>系统支持多种向量数据库存储方案，包括Milvus和ChromaDB，实现了高效的向量数据存储和检索。</p><h3 id="向量数据库架构" tabindex="-1">向量数据库架构 <a class="header-anchor" href="#向量数据库架构" aria-label="Permalink to &quot;向量数据库架构&quot;">​</a></h3><p>系统采用抽象的向量存储接口，支持多种向量数据库的无缝切换。当前主要支持Milvus作为向量存储后端。</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">classDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class VectorStoreBase {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+insert(vectors, payloads, ids)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+search(query, vectors, limit, filters)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+delete(vector_id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+update(vector_id, vector, payload)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+get(vector_id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+list_cols()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+delete_col()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+col_info()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+list(filters, limit)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+reset()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class MilvusDB {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-url : str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-token : str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-collection_name : str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-embedding_model_dims : int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-metric_type : MetricType</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-client : MilvusClient</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+create_col(collection_name, vector_size, metric_type)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+_create_filter(filters)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+_parse_output(data)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class ChromaDB {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-collection_name : str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-client : chromadb.Client</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-settings : Settings</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-collection : Collection</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+_parse_output(data)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+create_col(name, embedding_fn)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+_generate_where_clause(where)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class MetricType {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+L2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+IP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+COSINE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+HAMMING</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+JACCARD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VectorStoreBase &lt;|-- MilvusDB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VectorStoreBase &lt;|-- ChromaDB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MilvusDB --&gt; MetricType</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p><strong>图示来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/milvus.py" target="_blank" rel="noreferrer">milvus.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py" target="_blank" rel="noreferrer">chroma.py</a></li></ul><h3 id="向量数据存储" tabindex="-1">向量数据存储 <a class="header-anchor" href="#向量数据存储" aria-label="Permalink to &quot;向量数据存储&quot;">​</a></h3><p>文档分块并生成向量后，系统将向量数据存储到向量数据库中。每个向量记录包含以下信息：</p><ul><li><code>id</code>: 块的唯一标识符</li><li><code>vectors</code>: 文本的向量表示</li><li><code>metadata</code>: 元数据，包括文件ID、文件名、知识库ID等</li></ul><p>存储过程采用批量插入方式，提高数据写入效率。系统还实现了错误处理和重试机制，确保数据的完整性和一致性。</p><p><strong>本节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/milvus.py#L1-L262" target="_blank" rel="noreferrer">milvus.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/memory/vector_stores/chroma.py#L1-L255" target="_blank" rel="noreferrer">chroma.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag_handler.py#L1-L152" target="_blank" rel="noreferrer">rag_handler.py</a></li></ul><h2 id="全文检索与重排序" tabindex="-1">全文检索与重排序 <a class="header-anchor" href="#全文检索与重排序" aria-label="Permalink to &quot;全文检索与重排序&quot;">​</a></h2><p>系统采用混合检索策略，结合向量数据库的语义搜索和Elasticsearch的全文检索，通过重排序模块提升检索结果的准确性。</p><h3 id="elasticsearch角色" tabindex="-1">Elasticsearch角色 <a class="header-anchor" href="#elasticsearch角色" aria-label="Permalink to &quot;Elasticsearch角色&quot;">​</a></h3><p>Elasticsearch在系统中主要负责全文检索，支持关键词匹配、模糊搜索和精确查询。系统将文档内容索引到Elasticsearch中，建立倒排索引，实现高效的文本检索。</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">classDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class ESClient {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-client : Elasticsearch</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+insert_documents(index_name, chunks)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+index_documents(index_name, chunks)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+search_documents(query, index_name)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+search_documents_summary(query, index_name)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+delete_documents(file_id, index_name)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+close()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class ESIndex {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+index_config</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+index_search_content</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+index_search_summary</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+index_delete</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ESClient --&gt; ESIndex</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>图示来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/es_client.py" target="_blank" rel="noreferrer">es_client.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/config/es_index.py" target="_blank" rel="noreferrer">es_index.py</a></li></ul><h3 id="重排序模块" tabindex="-1">重排序模块 <a class="header-anchor" href="#重排序模块" aria-label="Permalink to &quot;重排序模块&quot;">​</a></h3><p>重排序模块是提升检索精度的关键组件。系统首先从向量数据库和Elasticsearch获取初步检索结果，然后通过重排序模型对结果进行重新排序。</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Query as &quot;查询&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant VectorDB as &quot;向量数据库&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant ES as &quot;Elasticsearch&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Reranker as &quot;重排序器&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Result as &quot;最终结果&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Query-&gt;&gt;VectorDB : 语义搜索</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Query-&gt;&gt;ES : 全文搜索</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VectorDB--&gt;&gt;Reranker : 初步结果1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ES--&gt;&gt;Reranker : 初步结果2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Reranker-&gt;&gt;Reranker : 合并去重</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Reranker-&gt;&gt;Reranker : 重排序</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Reranker-&gt;&gt;Reranker : 过滤低分结果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Reranker--&gt;&gt;Result : 最终排序结果</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>图示来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag_handler.py" target="_blank" rel="noreferrer">rag_handler.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/rerank.py" target="_blank" rel="noreferrer">rerank.py</a></li></ul><p><strong>本节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/es_client.py#L1-L199" target="_blank" rel="noreferrer">es_client.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/rerank.py#L1-L61" target="_blank" rel="noreferrer">rerank.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag_handler.py#L1-L152" target="_blank" rel="noreferrer">rag_handler.py</a></li></ul><h2 id="rag问答集成" tabindex="-1">RAG问答集成 <a class="header-anchor" href="#rag问答集成" aria-label="Permalink to &quot;RAG问答集成&quot;">​</a></h2><p>RAG（检索增强生成）是系统的核心功能，将检索到的相关文档内容注入到大语言模型的上下文中，生成准确的回答。</p><h3 id="查询扩展" tabindex="-1">查询扩展 <a class="header-anchor" href="#查询扩展" aria-label="Permalink to &quot;查询扩展&quot;">​</a></h3><p>系统在处理用户查询时，首先进行查询扩展，通过查询重写模块生成多个相关查询，提高检索的召回率。</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">classDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class QueryRewrite {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-client : ModelManager</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+rewrite(user_input)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class RagHandler {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+query_rewrite(query)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+mix_retrival_documents(query_list, knowledges_id, search_field)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+rag_query_summary(query, knowledges_id, min_score, top_k, needs_query_rewrite)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+retrieve_ranked_documents(query, collection_names, index_names, min_score, top_k, needs_query_rewrite)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+delete_documents_es_milvus(file_id, knowledge_id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RagHandler --&gt; QueryRewrite</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RagHandler --&gt; retrieval</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RagHandler --&gt; es_client</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RagHandler --&gt; milvus_client</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RagHandler --&gt; Reranker</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>图示来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag_handler.py" target="_blank" rel="noreferrer">rag_handler.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rewrite/query_write.py" target="_blank" rel="noreferrer">query_write.py</a></li></ul><h3 id="上下文注入与结果生成" tabindex="-1">上下文注入与结果生成 <a class="header-anchor" href="#上下文注入与结果生成" aria-label="Permalink to &quot;上下文注入与结果生成&quot;">​</a></h3><p>RAG流程包括以下步骤：</p><ol><li><strong>查询重写</strong>: 扩展用户查询，生成多个相关查询</li><li><strong>文档检索</strong>: 从向量数据库和Elasticsearch检索相关文档</li><li><strong>重排序</strong>: 对检索结果进行重新排序，提升相关性</li><li><strong>上下文注入</strong>: 将排序后的文档内容拼接为上下文</li><li><strong>结果生成</strong>: 将上下文和原始查询发送给大语言模型，生成最终回答</li></ol><p><strong>本节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag_handler.py#L1-L152" target="_blank" rel="noreferrer">rag_handler.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rewrite/query_write.py#L1-L27" target="_blank" rel="noreferrer">query_write.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/retrieval.py#L1-L46" target="_blank" rel="noreferrer">retrieval.py</a></li></ul><h2 id="api接口与前端交互" tabindex="-1">API接口与前端交互 <a class="header-anchor" href="#api接口与前端交互" aria-label="Permalink to &quot;API接口与前端交互&quot;">​</a></h2><p>系统提供了RESTful API接口，前端通过这些接口与后端进行交互，实现知识库文件的管理和语义搜索功能。</p><h3 id="api接口设计" tabindex="-1">API接口设计 <a class="header-anchor" href="#api接口设计" aria-label="Permalink to &quot;API接口设计&quot;">​</a></h3><p>系统提供了以下主要API接口：</p><ul><li><code>/knowledge/create</code>: 创建知识库</li><li><code>/knowledge/select</code>: 查询用户的知识库列表</li><li><code>/knowledge/update</code>: 更新知识库信息</li><li><code>/knowledge/delete</code>: 删除知识库</li><li><code>/knowledge/retrieval</code>: 执行知识库检索</li></ul><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">classDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class KnowledgeCreateRequest {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+knowledge_name : str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+knowledge_desc : str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class KnowledgeUpdateRequest {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+knowledge_id : str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+knowledge_name : str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+knowledge_desc : str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class UnifiedResponseModel {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+code : int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+message : str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+data : Any</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class resp_200 {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+code : 200</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+message : &quot;Success&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class resp_500 {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+code : 500</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+message : str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">UnifiedResponseModel &lt;|-- resp_200</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">UnifiedResponseModel &lt;|-- resp_500</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>图示来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/api/v1/knowledge.py" target="_blank" rel="noreferrer">knowledge.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/schema/schemas.py" target="_blank" rel="noreferrer">schemas.py</a></li></ul><h3 id="前端页面交互" tabindex="-1">前端页面交互 <a class="header-anchor" href="#前端页面交互" aria-label="Permalink to &quot;前端页面交互&quot;">​</a></h3><p>前端页面提供了知识库管理界面，用户可以创建、查看、更新和删除知识库。在问答界面，用户可以输入问题，系统返回基于知识库的检索结果。</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant User as &quot;用户&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Frontend as &quot;前端界面&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Backend as &quot;后端API&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant RAG as &quot;RAG系统&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">User-&gt;&gt;Frontend : 输入问题</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Frontend-&gt;&gt;Backend : 调用/knowledge/retrieval</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Backend-&gt;&gt;RAG : 执行检索流程</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RAG-&gt;&gt;Backend : 返回检索结果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Backend-&gt;&gt;Frontend : 返回响应</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Frontend-&gt;&gt;User : 显示答案</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>图示来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/api/v1/knowledge.py" target="_blank" rel="noreferrer">knowledge.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/frontend/src/apis/knowledge-file.ts" target="_blank" rel="noreferrer">knowledge-file.ts</a></li></ul><p><strong>本节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/api/v1/knowledge.py#L1-L74" target="_blank" rel="noreferrer">knowledge.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/frontend/src/apis/knowledge-file.ts" target="_blank" rel="noreferrer">knowledge-file.ts</a></li></ul><h2 id="常见问题与优化策略" tabindex="-1">常见问题与优化策略 <a class="header-anchor" href="#常见问题与优化策略" aria-label="Permalink to &quot;常见问题与优化策略&quot;">​</a></h2><h3 id="检索结果不相关" tabindex="-1">检索结果不相关 <a class="header-anchor" href="#检索结果不相关" aria-label="Permalink to &quot;检索结果不相关&quot;">​</a></h3><p>当检索结果不相关时，可能的原因包括：</p><ul><li>查询重写效果不佳</li><li>向量模型与领域不匹配</li><li>分块策略不合理</li></ul><p>解决方案：</p><ol><li>调整查询重写提示词，提高重写质量</li><li>使用领域特定的嵌入模型</li><li>优化分块策略，确保语义完整性</li></ol><h3 id="解析失败" tabindex="-1">解析失败 <a class="header-anchor" href="#解析失败" aria-label="Permalink to &quot;解析失败&quot;">​</a></h3><p>文档解析失败的常见原因：</p><ul><li>文件格式不支持</li><li>文件损坏</li><li>解析器依赖库缺失</li></ul><p>解决方案：</p><ol><li>确认文件格式是否在支持列表中</li><li>验证文件完整性</li><li>安装必要的依赖库</li></ol><h3 id="索引优化" tabindex="-1">索引优化 <a class="header-anchor" href="#索引优化" aria-label="Permalink to &quot;索引优化&quot;">​</a></h3><p>为提高检索性能，建议：</p><ul><li>定期优化向量数据库索引</li><li>合理设置分块大小和重叠</li><li>使用合适的距离度量方法</li></ul><h3 id="性能调优策略" tabindex="-1">性能调优策略 <a class="header-anchor" href="#性能调优策略" aria-label="Permalink to &quot;性能调优策略&quot;">​</a></h3><ol><li><strong>并发处理</strong>: 使用信号量限制并发任务数，避免资源耗尽</li><li><strong>批量操作</strong>: 采用批量插入和查询，减少网络开销</li><li><strong>缓存机制</strong>: 对频繁查询的结果进行缓存</li><li><strong>异步处理</strong>: 使用异步IO提高系统吞吐量</li></ol><p><strong>本节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag_handler.py" target="_blank" rel="noreferrer">rag_handler.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/parser.py" target="_blank" rel="noreferrer">parser.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/rag/embedding.py" target="_blank" rel="noreferrer">embedding.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/services/retrieval.py" target="_blank" rel="noreferrer">retrieval.py</a></li></ul>`,107)])])}const g=a(l,[["render",r]]);export{d as __pageData,g as default};
