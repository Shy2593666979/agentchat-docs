import{_ as s,c as e,o as i,ag as t}from"./chunks/framework.D0TaUBpX.js";const g=JSON.parse('{"title":"调试技巧","description":"","frontmatter":{},"headers":[],"relativePath":"开发指南/调试技巧.md","filePath":"开发指南/调试技巧.md","lastUpdated":1764244560000}'),n={name:"开发指南/调试技巧.md"};function l(r,a,h,p,o,c){return i(),e("div",null,[...a[0]||(a[0]=[t(`<h1 id="调试技巧" tabindex="-1">调试技巧 <a class="header-anchor" href="#调试技巧" aria-label="Permalink to &quot;调试技巧&quot;">​</a></h1><cite> **本文档中引用的文件** - [vite.config.ts](https://github.com/Shy2593666979/AgentChat/src/frontend/vite.config.ts) - [DEBUGGING_GUIDE.md](https://github.com/Shy2593666979/AgentChat/src/frontend/DEBUGGING_GUIDE.md) - [fix_fastapi_jwt_auth.py](https://github.com/Shy2593666979/AgentChat/scripts/fix_fastapi_jwt_auth.py) - [main.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/main.py) - [settings.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/settings.py) - [JWT.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/api/JWT.py) - [trace_id_middleware.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/middleware/trace_id_middleware.py) - [white_list_middleware.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/middleware/white_list_middleware.py) - [AgentDebug.vue](https://github.com/Shy2593666979/AgentChat/src/frontend/src/pages/agent/AgentDebug.vue) </cite><h2 id="目录" tabindex="-1">目录 <a class="header-anchor" href="#目录" aria-label="Permalink to &quot;目录&quot;">​</a></h2><ol><li><a href="#引言">引言</a></li><li><a href="#前端调试方法">前端调试方法</a></li><li><a href="#后端调试方法">后端调试方法</a></li><li><a href="#常见错误排查路径">常见错误排查路径</a></li><li><a href="#调试工具与脚本">调试工具与脚本</a></li><li><a href="#综合调试流程">综合调试流程</a></li></ol><h2 id="引言" tabindex="-1">引言 <a class="header-anchor" href="#引言" aria-label="Permalink to &quot;引言&quot;">​</a></h2><p>本指南旨在为AgentChat项目提供系统化的调试方法。通过结合前端和后端的调试工具与技术，开发者可以高效地定位和解决开发过程中遇到的问题。文档涵盖了从环境配置检查到具体错误代码的完整排查路径。</p><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/frontend/DEBUGGING_GUIDE.md" target="_blank" rel="noreferrer">DEBUGGING_GUIDE.md</a></li></ul><h2 id="前端调试方法" tabindex="-1">前端调试方法 <a class="header-anchor" href="#前端调试方法" aria-label="Permalink to &quot;前端调试方法&quot;">​</a></h2><h3 id="vue-devtools监控" tabindex="-1">Vue Devtools监控 <a class="header-anchor" href="#vue-devtools监控" aria-label="Permalink to &quot;Vue Devtools监控&quot;">​</a></h3><p>使用Vue Devtools可以实时监控组件状态和事件流，这对于理解应用的数据流动和组件交互至关重要。通过检查组件的props、data和events，可以快速识别状态管理问题。</p><h3 id="浏览器开发者工具" tabindex="-1">浏览器开发者工具 <a class="header-anchor" href="#浏览器开发者工具" aria-label="Permalink to &quot;浏览器开发者工具&quot;">​</a></h3><p>结合浏览器开发者工具的Network和Console面板进行调试：</p><ul><li><strong>Network面板</strong>：分析API请求与响应，检查请求头、响应状态码和数据格式</li><li><strong>Console面板</strong>：查看JavaScript错误、警告和调试输出</li><li><strong>Application面板</strong>：检查localStorage中的认证token等持久化数据</li></ul><h3 id="代理配置检查" tabindex="-1">代理配置检查 <a class="header-anchor" href="#代理配置检查" aria-label="Permalink to &quot;代理配置检查&quot;">​</a></h3><p>在<code>vite.config.ts</code>中确认代理设置是否正确，确保前端开发服务器能够正确转发API请求到后端服务：</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">proxy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;/api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    target: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://localhost:7860/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    changeOrigin: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/frontend/vite.config.ts" target="_blank" rel="noreferrer">vite.config.ts</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/frontend/src/pages/agent/AgentDebug.vue" target="_blank" rel="noreferrer">AgentDebug.vue</a></li></ul><h2 id="后端调试方法" tabindex="-1">后端调试方法 <a class="header-anchor" href="#后端调试方法" aria-label="Permalink to &quot;后端调试方法&quot;">​</a></h2><h3 id="fastapi热重载" tabindex="-1">FastAPI热重载 <a class="header-anchor" href="#fastapi热重载" aria-label="Permalink to &quot;FastAPI热重载&quot;">​</a></h3><p>利用FastAPI的热重载功能，在代码变更时自动重启服务，实时查看变更效果。启动命令如下：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> agentchat.main</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>服务默认运行在 <code>http://localhost:7860</code>。</p><h3 id="日志追踪" tabindex="-1">日志追踪 <a class="header-anchor" href="#日志追踪" aria-label="Permalink to &quot;日志追踪&quot;">​</a></h3><p>通过loguru日志和trace_id_middleware追踪请求链路：</p><ul><li><strong>loguru日志</strong>：提供结构化的日志输出，便于问题定位</li><li><strong>trace_id_middleware</strong>：为每个请求分配唯一的trace ID，实现跨组件的请求追踪</li></ul><h3 id="认证与白名单" tabindex="-1">认证与白名单 <a class="header-anchor" href="#认证与白名单" aria-label="Permalink to &quot;认证与白名单&quot;">​</a></h3><p>后端通过JWT进行认证，并使用白名单中间件控制访问权限：</p><ul><li><strong>JWT认证</strong>：基于<code>fastapi-jwt-auth</code>实现，配置在<code>api/JWT.py</code></li><li><strong>白名单中间件</strong>：<code>white_list_middleware.py</code>实现了路径白名单检查机制</li></ul><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Frontend as 前端</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Backend as 后端</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">participant Middleware as 中间件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Frontend-&gt;&gt;Backend : API请求</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Backend-&gt;&gt;Middleware : 请求进入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Middleware-&gt;&gt;Middleware : 添加Trace ID</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Middleware-&gt;&gt;Middleware : 检查白名单</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Middleware-&gt;&gt;Backend : 继续处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Backend-&gt;&gt;Backend : JWT认证验证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Backend-&gt;&gt;Frontend : 返回响应</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>Diagram sources</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/main.py" target="_blank" rel="noreferrer">main.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/middleware/trace_id_middleware.py" target="_blank" rel="noreferrer">trace_id_middleware.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/middleware/white_list_middleware.py" target="_blank" rel="noreferrer">white_list_middleware.py</a></li></ul><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/main.py" target="_blank" rel="noreferrer">main.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/settings.py" target="_blank" rel="noreferrer">settings.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/api/JWT.py" target="_blank" rel="noreferrer">JWT.py</a></li></ul><h2 id="常见错误排查路径" tabindex="-1">常见错误排查路径 <a class="header-anchor" href="#常见错误排查路径" aria-label="Permalink to &quot;常见错误排查路径&quot;">​</a></h2><h3 id="_401-unauthorized" tabindex="-1">401 Unauthorized <a class="header-anchor" href="#_401-unauthorized" aria-label="Permalink to &quot;401 Unauthorized&quot;">​</a></h3><ul><li><strong>原因</strong>：token无效或未提供</li><li><strong>排查步骤</strong>： <ol><li>检查localStorage中是否存在token</li><li>确认token是否过期</li><li>检查Authorization请求头格式是否正确</li><li>验证JWT配置是否正确</li></ol></li></ul><h3 id="_404-not-found" tabindex="-1">404 Not Found <a class="header-anchor" href="#_404-not-found" aria-label="Permalink to &quot;404 Not Found&quot;">​</a></h3><ul><li><strong>原因</strong>：API路径错误或后端服务未启动</li><li><strong>排查步骤</strong>： <ol><li>确认后端服务是否正在运行</li><li>检查路由配置是否正确</li><li>验证代理配置是否将请求正确转发</li><li>确认API端点是否存在</li></ol></li></ul><h3 id="_500-internal-server-error" tabindex="-1">500 Internal Server Error <a class="header-anchor" href="#_500-internal-server-error" aria-label="Permalink to &quot;500 Internal Server Error&quot;">​</a></h3><ul><li><strong>原因</strong>：后端代码错误或数据库问题</li><li><strong>排查步骤</strong>： <ol><li>查看后端控制台日志</li><li>检查数据库连接状态</li><li>验证配置文件加载是否成功</li><li>检查依赖服务是否可用</li></ol></li></ul><h3 id="cors错误" tabindex="-1">CORS错误 <a class="header-anchor" href="#cors错误" aria-label="Permalink to &quot;CORS错误&quot;">​</a></h3><ul><li><strong>原因</strong>：跨域请求被阻止</li><li><strong>排查步骤</strong>： <ol><li>检查后端CORS配置</li><li>确认前端请求的origin是否被允许</li><li>验证代理配置是否正确处理跨域</li></ol></li></ul><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/frontend/DEBUGGING_GUIDE.md" target="_blank" rel="noreferrer">DEBUGGING_GUIDE.md</a></li></ul><h2 id="调试工具与脚本" tabindex="-1">调试工具与脚本 <a class="header-anchor" href="#调试工具与脚本" aria-label="Permalink to &quot;调试工具与脚本&quot;">​</a></h2><h3 id="agentdebug-vue调试页面" tabindex="-1">AgentDebug.vue调试页面 <a class="header-anchor" href="#agentdebug-vue调试页面" aria-label="Permalink to &quot;AgentDebug.vue调试页面&quot;">​</a></h3><p>项目提供了专门的<code>AgentDebug.vue</code>调试页面，用于测试智能体API：</p><ul><li>显示当前URL和token状态</li><li>提供API测试按钮</li><li>实时显示调试日志输出</li><li>支持网络连接测试</li></ul><h3 id="修复脚本" tabindex="-1">修复脚本 <a class="header-anchor" href="#修复脚本" aria-label="Permalink to &quot;修复脚本&quot;">​</a></h3><p><code>scripts/</code>目录下的修复脚本辅助诊断复杂问题：</p><h4 id="jwt兼容性修复" tabindex="-1">JWT兼容性修复 <a class="header-anchor" href="#jwt兼容性修复" aria-label="Permalink to &quot;JWT兼容性修复&quot;">​</a></h4><p><code>fix_fastapi_jwt_auth.py</code>脚本解决FastAPI JWT Auth与Pydantic 2的兼容性问题：</p><ul><li>自动定位fastapi_jwt_auth配置文件</li><li>备份原始配置文件</li><li>写入Pydantic 2兼容的配置内容</li><li>提供恢复机制</li></ul><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flowchart TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Start([开始修复]) --&gt; Locate[&quot;定位fastapi_jwt_auth配置文件&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Locate --&gt; Backup[&quot;备份原始文件&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Backup --&gt; Check[&quot;检查兼容性&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Check --&gt; |已兼容| Update[&quot;强制更新确保完全兼容&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Check --&gt; |未兼容| Fix[&quot;写入修复内容&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Update --&gt; Verify</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Fix --&gt; Verify[&quot;验证修复结果&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Verify --&gt; Success{&quot;修复成功?&quot;}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Success --&gt; |是| Complete[&quot;显示成功信息&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Success --&gt; |否| Error[&quot;显示错误信息&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Complete --&gt; End([修复完成])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Error --&gt; End</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>Diagram sources</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/scripts/fix_fastapi_jwt_auth.py" target="_blank" rel="noreferrer">fix_fastapi_jwt_auth.py</a></li></ul><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/scripts/fix_fastapi_jwt_auth.py" target="_blank" rel="noreferrer">fix_fastapi_jwt_auth.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/frontend/src/pages/agent/AgentDebug.vue" target="_blank" rel="noreferrer">AgentDebug.vue</a></li></ul><h2 id="综合调试流程" tabindex="-1">综合调试流程 <a class="header-anchor" href="#综合调试流程" aria-label="Permalink to &quot;综合调试流程&quot;">​</a></h2><h3 id="系统化调试步骤" tabindex="-1">系统化调试步骤 <a class="header-anchor" href="#系统化调试步骤" aria-label="Permalink to &quot;系统化调试步骤&quot;">​</a></h3><ol><li><strong>环境检查</strong>：确认前后端服务均已启动</li><li><strong>代理验证</strong>：检查vite.config.ts中的代理配置</li><li><strong>认证状态</strong>：验证localStorage中的token</li><li><strong>API测试</strong>：使用curl或Postman手动测试API</li><li><strong>日志分析</strong>：查看后端控制台和日志输出</li><li><strong>数据库检查</strong>：确认相关数据表存在且有数据</li></ol><h3 id="调试最佳实践" tabindex="-1">调试最佳实践 <a class="header-anchor" href="#调试最佳实践" aria-label="Permalink to &quot;调试最佳实践&quot;">​</a></h3><ul><li>使用<code>AgentDebug.vue</code>页面进行初步测试</li><li>在Network面板中复制请求为curl命令进行测试</li><li>利用trace ID追踪完整请求链路</li><li>定期检查配置文件的正确性</li><li>使用修复脚本处理已知兼容性问题</li></ul><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/src/frontend/DEBUGGING_GUIDE.md" target="_blank" rel="noreferrer">DEBUGGING_GUIDE.md</a></li></ul>`,67)])])}const u=s(n,[["render",l]]);export{g as __pageData,u as default};
