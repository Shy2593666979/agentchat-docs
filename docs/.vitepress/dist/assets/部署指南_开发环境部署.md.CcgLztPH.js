import{_ as r,c as l,o as n,ag as s,j as t,a}from"./chunks/framework.D0TaUBpX.js";const k=JSON.parse('{"title":"开发环境部署","description":"","frontmatter":{},"headers":[],"relativePath":"部署指南/开发环境部署.md","filePath":"部署指南/开发环境部署.md","lastUpdated":1764244560000}'),i={name:"部署指南/开发环境部署.md"};function o(h,e,p,c,d,g){return n(),l("div",null,[...e[0]||(e[0]=[s(`<h1 id="开发环境部署" tabindex="-1">开发环境部署 <a class="header-anchor" href="#开发环境部署" aria-label="Permalink to &quot;开发环境部署&quot;">​</a></h1><cite> **本文档引用的文件** - [docker-compose.yml](https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml) - [start.py](https://github.com/Shy2593666979/AgentChat/scripts/start.py) - [main.py](https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/main.py) - [Dockerfile](https://github.com/Shy2593666979/AgentChat/docker/Dockerfile) - [Dockerfile.frontend](https://github.com/Shy2593666979/AgentChat/docker/Dockerfile.frontend) - [Dockerfile.frontend.prod](https://github.com/Shy2593666979/AgentChat/docker/Dockerfile.frontend.prod) - [nginx.conf](https://github.com/Shy2593666979/AgentChat/docker/nginx.conf) - [docker-compose.prod.yml](https://github.com/Shy2593666979/AgentChat/docker/docker-compose.prod.yml) - [pyproject.toml](https://github.com/Shy2593666979/AgentChat/pyproject.toml) - [package.json](https://github.com/Shy2593666979/AgentChat/src/frontend/package.json) </cite><h2 id="目录" tabindex="-1">目录 <a class="header-anchor" href="#目录" aria-label="Permalink to &quot;目录&quot;">​</a></h2><ol><li><a href="#简介">简介</a></li><li><a href="#容器化部署方案">容器化部署方案</a></li><li><a href="#非容器化部署方案">非容器化部署方案</a></li><li><a href="#部署方式对比">部署方式对比</a></li><li><a href="#常见问题排查">常见问题排查</a></li><li><a href="#服务验证方法">服务验证方法</a></li></ol><h2 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-label="Permalink to &quot;简介&quot;">​</a></h2><p>本文档提供AgentChat项目的本地开发环境部署指南，涵盖两种主要部署方式：基于Docker的容器化部署和基于脚本的直接运行部署。文档详细说明了各服务的配置参数、依赖关系、端口映射和环境变量设置，并提供常见问题的解决方案。</p><h2 id="容器化部署方案" tabindex="-1">容器化部署方案 <a class="header-anchor" href="#容器化部署方案" aria-label="Permalink to &quot;容器化部署方案&quot;">​</a></h2><p>AgentChat项目提供了完整的Docker Compose配置，用于在隔离环境中快速启动所有服务。该方案通过<code>docker-compose.yml</code>文件定义了MySQL、Redis、后端API和前端服务的配置。</p><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A[开发环境] --&gt; B[MySQL]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A --&gt; C[Redis]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A --&gt; D[后端API]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A --&gt; E[前端服务]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">B --&gt; D[提供数据存储]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">C --&gt; D[提供缓存服务]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">D --&gt; E[提供API接口]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>图示来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml#L7-L126" target="_blank" rel="noreferrer">docker-compose.yml</a></li></ul><p><strong>本节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml#L7-L126" target="_blank" rel="noreferrer">docker-compose.yml</a></li></ul><h3 id="服务配置详解" tabindex="-1">服务配置详解 <a class="header-anchor" href="#服务配置详解" aria-label="Permalink to &quot;服务配置详解&quot;">​</a></h3><h4 id="mysql服务" tabindex="-1">MySQL服务 <a class="header-anchor" href="#mysql服务" aria-label="Permalink to &quot;MySQL服务&quot;">​</a></h4><p>MySQL服务作为项目的主要数据存储，配置如下：</p><ul><li><strong>容器名称</strong>: agentchat-mysql</li><li><strong>端口映射</strong>: 3306:3306 (主机:容器)</li><li><strong>环境变量</strong>: <ul><li>MYSQL_ROOT_PASSWORD: 123456</li><li>MYSQL_DATABASE: agentchat</li><li>MYSQL_USER: agentchat_user</li><li>MYSQL_PASSWORD: 123456</li></ul></li><li><strong>数据卷</strong>: mysql_data (持久化存储)</li><li><strong>健康检查</strong>: 使用mysqladmin ping命令检测服务状态</li></ul><h4 id="redis服务" tabindex="-1">Redis服务 <a class="header-anchor" href="#redis服务" aria-label="Permalink to &quot;Redis服务&quot;">​</a></h4><p>Redis服务提供缓存功能，配置如下：</p><ul><li><strong>容器名称</strong>: agentchat-redis</li><li><strong>端口映射</strong>: 6379:6379 (主机:容器)</li><li><strong>环境变量</strong>: TZ: Asia/Shanghai</li><li><strong>数据卷</strong>: redis_data (持久化存储)</li><li><strong>健康检查</strong>: 使用redis-cli ping命令检测服务状态</li></ul><h4 id="后端api服务" tabindex="-1">后端API服务 <a class="header-anchor" href="#后端api服务" aria-label="Permalink to &quot;后端API服务&quot;">​</a></h4><p>后端服务基于FastAPI框架，配置如下：</p>`,22),t("ul",null,[t("li",null,[t("strong",null,"容器名称"),a(": agentchat-backend")]),t("li",null,[t("strong",null,"端口映射"),a(": 7860:7860 (主机:容器)")]),t("li",null,[t("strong",null,"环境变量"),a(": "),t("ul",null,[t("li",null,"DATABASE_URL: mysql://agentchat_user:123456@mysql:3306/agentchat"),t("li",null,"REDIS_URL: redis://redis:6379/0"),t("li",null,"APP_ENV: development"),t("li",null,"JWT_SECRET_KEY: your-super-secret-jwt-key-change-in-production"),t("li",{"OPENAI_API_KEY:-":""},"OPENAI_API_KEY: $")])]),t("li",null,[t("strong",null,"依赖关系"),a(": 依赖MySQL和Redis服务，且需等待它们健康后才启动")]),t("li",null,[t("strong",null,"健康检查"),a(": 通过curl访问"),t("a",{href:"http://localhost:7860/health%E6%8E%A5%E5%8F%A3%E6%A3%80%E6%B5%8B%E6%9C%8D%E5%8A%A1%E7%8A%B6%E6%80%81",target:"_blank",rel:"noreferrer"},"http://localhost:7860/health接口检测服务状态")])],-1),s(`<h4 id="前端服务" tabindex="-1">前端服务 <a class="header-anchor" href="#前端服务" aria-label="Permalink to &quot;前端服务&quot;">​</a></h4><p>前端服务基于Vue框架，配置如下：</p><ul><li><strong>容器名称</strong>: agentchat-frontend</li><li><strong>端口映射</strong>: 8090:8090 (主机:容器)</li><li><strong>环境变量</strong>: <ul><li>NODE_ENV: development</li><li>VITE_API_BASE_URL: <a href="http://localhost:7860" target="_blank" rel="noreferrer">http://localhost:7860</a></li></ul></li><li><strong>依赖关系</strong>: 依赖后端服务</li><li><strong>健康检查</strong>: 通过curl访问http://localhost:8090检测服务状态</li></ul><p><strong>本节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml#L9-L118" target="_blank" rel="noreferrer">docker-compose.yml</a></li></ul><h2 id="非容器化部署方案" tabindex="-1">非容器化部署方案 <a class="header-anchor" href="#非容器化部署方案" aria-label="Permalink to &quot;非容器化部署方案&quot;">​</a></h2><p>对于需要频繁调试的开发者，项目提供了<code>scripts/start.py</code>脚本，可直接在本地环境中启动服务。</p><h3 id="脚本执行流程" tabindex="-1">脚本执行流程 <a class="header-anchor" href="#脚本执行流程" aria-label="Permalink to &quot;脚本执行流程&quot;">​</a></h3><div class="language-mermaid vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flowchart TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Start([执行start.py]) --&gt; Install[&quot;安装依赖&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Install --&gt; CheckDeps{&quot;依赖文件存在?&quot;}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CheckDeps --&gt; |是| InstallPip[&quot;pip install -r requirements.txt&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CheckDeps --&gt; |否| SkipInstall[&quot;跳过安装&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">InstallPip --&gt; StartBackend[&quot;启动后端服务&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SkipInstall --&gt; StartBackend</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">StartBackend --&gt; StartFrontend[&quot;启动前端服务&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">StartFrontend --&gt; Monitor[&quot;监控服务状态&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Monitor --&gt; End[&quot;服务运行中&quot;]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>图示来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/scripts/start.py#L25-L125" target="_blank" rel="noreferrer">start.py</a></li></ul><p><strong>本节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/scripts/start.py#L25-L125" target="_blank" rel="noreferrer">start.py</a></li></ul><h3 id="实现逻辑分析" tabindex="-1">实现逻辑分析 <a class="header-anchor" href="#实现逻辑分析" aria-label="Permalink to &quot;实现逻辑分析&quot;">​</a></h3><p><code>start.py</code>脚本的主要功能包括：</p><ol><li><strong>路径设置</strong>: 自动识别项目根目录、后端目录和前端目录</li><li><strong>依赖安装</strong>: 在项目根目录查找<code>request*.txt</code>或<code>requirements.txt</code>文件并安装Python依赖</li><li><strong>并发启动</strong>: 使用subprocess.Popen同时启动后端和前端服务</li><li><strong>进程管理</strong>: 维护进程列表，支持通过Ctrl+C优雅关闭所有服务</li></ol><p>后端服务通过uvicorn启动，监听7860端口；前端服务通过npm run dev启动，监听8090端口。脚本会实时显示两个服务的日志输出。</p><p><strong>本节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/scripts/start.py#L25-L125" target="_blank" rel="noreferrer">start.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/main.py#L104-L108" target="_blank" rel="noreferrer">main.py</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/frontend/package.json#L7" target="_blank" rel="noreferrer">package.json</a></li></ul><h2 id="部署方式对比" tabindex="-1">部署方式对比 <a class="header-anchor" href="#部署方式对比" aria-label="Permalink to &quot;部署方式对比&quot;">​</a></h2><table tabindex="0"><thead><tr><th>特性</th><th>容器化部署</th><th>非容器化部署</th></tr></thead><tbody><tr><td><strong>环境隔离</strong></td><td>高，完全隔离</td><td>低，依赖本地环境</td></tr><tr><td><strong>依赖管理</strong></td><td>内置，自动安装</td><td>需手动管理</td></tr><tr><td><strong>启动速度</strong></td><td>较慢，需构建镜像</td><td>快，直接运行</td></tr><tr><td><strong>调试便利性</strong></td><td>较差，需进入容器</td><td>好，直接修改代码</td></tr><tr><td><strong>端口冲突</strong></td><td>少，独立网络</td><td>可能发生</td></tr><tr><td><strong>适用场景</strong></td><td>生产环境、团队协作</td><td>本地开发、调试</td></tr></tbody></table><p><strong>本节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml" target="_blank" rel="noreferrer">docker-compose.yml</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/scripts/start.py" target="_blank" rel="noreferrer">start.py</a></li></ul><h2 id="常见问题排查" tabindex="-1">常见问题排查 <a class="header-anchor" href="#常见问题排查" aria-label="Permalink to &quot;常见问题排查&quot;">​</a></h2><h3 id="端口冲突" tabindex="-1">端口冲突 <a class="header-anchor" href="#端口冲突" aria-label="Permalink to &quot;端口冲突&quot;">​</a></h3><p>当指定端口已被占用时，服务无法启动。解决方案：</p><ol><li>使用<code>netstat -ano | findstr :端口号</code>（Windows）或<code>lsof -i :端口号</code>（Linux/Mac）查找占用进程</li><li>终止占用进程或修改docker-compose.yml中的端口映射</li></ol><h3 id="依赖安装失败" tabindex="-1">依赖安装失败 <a class="header-anchor" href="#依赖安装失败" aria-label="Permalink to &quot;依赖安装失败&quot;">​</a></h3><p>可能原因及解决方案：</p><ul><li><strong>缺少requirements.txt</strong>: 确保项目根目录存在依赖文件</li><li><strong>网络问题</strong>: 配置pip镜像源或使用国内镜像</li><li><strong>权限问题</strong>: 以管理员权限运行安装命令</li></ul><h3 id="服务启动超时" tabindex="-1">服务启动超时 <a class="header-anchor" href="#服务启动超时" aria-label="Permalink to &quot;服务启动超时&quot;">​</a></h3><p>特别是MySQL和后端服务可能因初始化耗时较长而超时：</p><ul><li>增加healthcheck的retries和timeout值</li><li>检查数据库初始化脚本是否过于复杂</li><li>确保有足够的系统资源</li></ul><h3 id="环境变量未设置" tabindex="-1">环境变量未设置 <a class="header-anchor" href="#环境变量未设置" aria-label="Permalink to &quot;环境变量未设置&quot;">​</a></h3><p>对于AI模型相关的API密钥，需在运行前设置：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OPENAI_API_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">your_key</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_API_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">your_key</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>本节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml#L72-L74" target="_blank" rel="noreferrer">docker-compose.yml</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/scripts/start.py#L25-L53" target="_blank" rel="noreferrer">start.py</a></li></ul><h2 id="服务验证方法" tabindex="-1">服务验证方法 <a class="header-anchor" href="#服务验证方法" aria-label="Permalink to &quot;服务验证方法&quot;">​</a></h2><h3 id="访问前端界面" tabindex="-1">访问前端界面 <a class="header-anchor" href="#访问前端界面" aria-label="Permalink to &quot;访问前端界面&quot;">​</a></h3><p>启动成功后，可通过浏览器访问http://localhost:8090查看前端界面是否正常加载。</p><h3 id="调用健康检查接口" tabindex="-1">调用健康检查接口 <a class="header-anchor" href="#调用健康检查接口" aria-label="Permalink to &quot;调用健康检查接口&quot;">​</a></h3><p>各服务提供了健康检查接口，可用于验证服务状态：</p><ul><li><strong>前端</strong>: <a href="http://localhost:8090/health" target="_blank" rel="noreferrer">http://localhost:8090/health</a> (返回&quot;healthy&quot;)</li><li><strong>后端</strong>: <a href="http://localhost:7860/health" target="_blank" rel="noreferrer">http://localhost:7860/health</a> (返回{&quot;status&quot;: &quot;OK&quot;})</li><li><strong>MySQL</strong>: 使用mysql客户端连接3306端口</li><li><strong>Redis</strong>: 使用redis-cli ping命令</li></ul><h3 id="api功能测试" tabindex="-1">API功能测试 <a class="header-anchor" href="#api功能测试" aria-label="Permalink to &quot;API功能测试&quot;">​</a></h3><p>通过前端界面或Postman等工具调用主要API接口，验证数据交互是否正常。</p><p><strong>本节来源</strong></p><ul><li><a href="https://github.com/Shy2593666979/AgentChat/docker/docker-compose.yml#L89-L92" target="_blank" rel="noreferrer">docker-compose.yml</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/docker/nginx.conf#L95-L98" target="_blank" rel="noreferrer">nginx.conf</a></li><li><a href="https://github.com/Shy2593666979/AgentChat/src/backend/agentchat/main.py#L24-L26" target="_blank" rel="noreferrer">main.py</a></li></ul>`,48)])])}const b=r(i,[["render",o]]);export{k as __pageData,b as default};
